{% extends "base.html" %}

{% block title %}Master Bahan - SPPG{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title"><i class="fas fa-boxes"></i> Master Data Bahan</h2>
        <a href="{{ url_for('tambah_bahan') }}" class="btn btn-success">
            <i class="fas fa-plus"></i> Tambah Bahan
        </a>
    </div>
    
    <!-- Filter Section -->
    <div class="filter-section">
        <form method="GET" action="{{ url_for('master_bahan') }}" class="filter-form">
            <div class="form-group">
                <label class="form-label">Cari</label>
                <input type="text" class="form-control" name="keyword" value="{{ keyword }}" 
                       placeholder="Kode atau Nama Bahan...">
            </div>
            
            <div class="form-group">
                <label class="form-label">Kategori</label>
                <select class="form-control" name="kategori">
                    <option value="">Semua Kategori</option>
                    {% for kategori in kategori_list %}
                    <option value="{{ kategori.id }}" {% if filter_kategori|string == kategori.id|string %}selected{% endif %}>
                        {{ kategori.nama_kategori }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Cari
                </button>
                <a href="{{ url_for('master_bahan') }}" class="btn btn-warning">
                    <i class="fas fa-redo"></i> Reset
                </a>
            </div>
        </form>
    </div>
    
    <!-- Table -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Kode</th>
                    <th>Nama Bahan</th>
                    <th>Kategori</th>
                    <th>Satuan</th>
                    <th>Stok Sekarang</th>
                    <th>Stok Min</th>
                    <th>Stok Max</th>
                    <th>Status Stok</th>
                    <th>Berat/Unit</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for item in bahan %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td><strong>{{ item.kode_bahan }}</strong></td>
                    <td>
                        <div><strong>{{ item.nama_bahan }}</strong></div>
                        {% if item.keterangan %}
                        <small class="text-muted">{{ item.keterangan }}</small>
                        {% endif %}
                    </td>
                    <td>{{ item.nama_kategori or '-' }}</td>
                    <td>{{ item.nama_satuan or '-' }}</td>
                    <td>{{ item.stok_sekarang|format_number }}</td>
                    <td>{{ item.stok_minimum|format_number }}</td>
                    <td>{{ item.stok_maksimum|format_number }}</td>
                    <td>
                        {% set stok_sekarang = item.stok_sekarang|to_float %}
                        {% set stok_minimum = item.stok_minimum|to_float %}
                        <span class="badge 
                            {% if stok_sekarang <= stok_minimum %}
                                bg-danger
                            {% elif stok_sekarang <= stok_minimum * 1.5 %}
                                bg-warning
                            {% else %}
                                bg-success
                            {% endif %}">
                            {% if stok_sekarang <= stok_minimum %}
                                KRITIS
                            {% elif stok_sekarang <= stok_minimum * 1.5 %}
                                RENDAH
                            {% else %}
                                AMAN
                            {% endif %}
                        </span>
                    </td>
                    <td>{{ item.berat_per_unit|format_number }} g</td>
                    <td>
                        <button class="btn btn-sm btn-info" title="Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="11" style="text-align: center; padding: 30px;">
                        <i class="fas fa-box fa-2x text-muted mb-3"></i><br>
                        Tidak ada data bahan ditemukan
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Summary -->
    <div class="row" style="display: flex; gap: 20px; margin-top: 20px;">
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #3498db;">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-info">
                <h4>{{ bahan|length }}</h4>
                <p>Total Bahan</p>
            </div>
        </div>
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #e74c3c;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-info">
                <h4>{{ stok_kritis }}</h4>
                <p>Stok Kritis</p>
            </div>
        </div>
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #f39c12;">
                <i class="fas fa-balance-scale"></i>
            </div>
            <div class="stat-info">
                <h4>{{ total_stok|format_number }}</h4>
                <p>Total Stok</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}