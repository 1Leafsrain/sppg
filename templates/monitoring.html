{% extends "base.html" %}

{% block title %}Monitoring Kualitas - SPPG{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title"><i class="fas fa-clipboard-check"></i> Monitoring Kualitas Bahan</h2>
        <a href="{{ url_for('tambah_monitoring') }}" class="btn btn-success">
            <i class="fas fa-plus"></i> Tambah Monitoring
        </a>
    </div>
    
    <!-- Filter Section -->
    <div class="filter-section">
        <form method="GET" action="{{ url_for('monitoring') }}" class="filter-form">
            <div class="form-group">
                <label class="form-label">Tanggal Mulai</label>
                <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
            </div>
            
            <div class="form-group">
                <label class="form-label">Tanggal Akhir</label>
                <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
            </div>
            
            <div class="form-group">
                <label class="form-label">Bahan</label>
                <select class="form-control" name="bahan_id">
                    <option value="">Semua Bahan</option>
                    {% for bahan in bahan_list %}
                    <option value="{{ bahan.id }}" {% if bahan_id|string == bahan.id|string %}selected{% endif %}>
                        {{ bahan.nama_bahan }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter"></i> Filter
                </button>
                <a href="{{ url_for('monitoring') }}" class="btn btn-warning">
                    <i class="fas fa-redo"></i> Reset
                </a>
            </div>
        </form>
    </div>
    
    <!-- Info Card -->
    <div class="alert alert-info mb-4">
        <i class="fas fa-info-circle"></i>
        <strong>Informasi:</strong> Monitoring kualitas bahan makanan dilakukan secara berkala untuk 
        memastikan keamanan dan kualitas bahan sesuai standar Badan Gizi Nasional (BGN).
    </div>
    
    <!-- Table -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Tanggal</th>
                    <th>Bahan</th>
                    <th>Suhu</th>
                    <th>Kelembaban</th>
                    <th>Kondisi Fisik</th>
                    <th>Kondisi Kemasan</th>
                    <th>Status Kadaluarsa</th>
                    <th>Petugas</th>
                    <th>Catatan</th>
                </tr>
            </thead>
            <tbody>
                {% for item in monitoring %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ item.tanggal_check }}</td>
                    <td>
                        <div><strong>{{ item.kode_bahan }}</strong></div>
                        <small>{{ item.nama_bahan }}</small>
                    </td>
                    <td>
                        {% if item.suhu_gudang %}
                            {{ item.suhu_gudang }} Â°C
                            {% if item.suhu_gudang <= 15 %}
                                <br><small class="text-info">(Dingin)</small>
                            {% elif item.suhu_gudang <= 25 %}
                                <br><small class="text-success">(Optimal)</small>
                            {% else %}
                                <br><small class="text-warning">(Panas)</small>
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if item.kelembaban_gudang %}
                            {{ item.kelembaban_gudang }}%
                            {% if item.kelembaban_gudang <= 40 %}
                                <br><small class="text-warning">(Kering)</small>
                            {% elif item.kelembaban_gudang <= 70 %}
                                <br><small class="text-success">(Optimal)</small>
                            {% else %}
                                <br><small class="text-danger">(Lembab)</small>
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if item.kondisi_fisik == 'sangat_baik' %}
                        <span class="badge bg-success">Sangat Baik</span>
                        {% elif item.kondisi_fisik == 'baik' %}
                        <span class="badge bg-primary">Baik</span>
                        {% elif item.kondisi_fisik == 'cukup' %}
                        <span class="badge bg-warning">Cukup</span>
                        {% else %}
                        <span class="badge bg-danger">Buruk</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.kondisi_kemasan == 'utuh' %}
                        <span class="badge bg-success">Utuh</span>
                        {% elif item.kondisi_kemasan == 'rusak_ringan' %}
                        <span class="badge bg-warning">Rusak Ringan</span>
                        {% else %}
                        <span class="badge bg-danger">Rusak Berat</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.status_kadaluarsa == 'aman' %}
                        <span class="badge bg-success">Aman</span>
                        {% elif item.status_kadaluarsa == 'mendekati' %}
                        <span class="badge bg-warning">Mendekati</span>
                        {% else %}
                        <span class="badge bg-danger">Kadaluarsa</span>
                        {% endif %}
                    </td>
                    <td>{{ item.petugas or '-' }}</td>
                    <td>
                        {% if item.catatan %}
                            <small>{{ item.catatan[:50] }}{% if item.catatan|length > 50 %}...{% endif %}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="10" style="text-align: center; padding: 30px;">
                        <i class="fas fa-clipboard-list fa-2x text-muted mb-3"></i><br>
                        Tidak ada data monitoring ditemukan
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Summary Statistics -->
    <div class="row" style="display: flex; gap: 20px; margin-top: 20px;">
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #2ecc71;">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                {% set aman = monitoring|selectattr('status_kadaluarsa', 'equalto', 'aman')|list|length %}
                <h4>{{ aman }}</h4>
                <p>Bahan Aman</p>
            </div>
        </div>
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #f39c12;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-info">
                {% set mendekati = monitoring|selectattr('status_kadaluarsa', 'equalto', 'mendekati')|list|length %}
                <h4>{{ mendekati }}</h4>
                <p>Mendekati Kadaluarsa</p>
            </div>
        </div>
        <div class="stat-card" style="flex: 1; padding: 15px; margin: 0;">
            <div class="stat-icon" style="width: 50px; height: 50px; font-size: 1.5rem; margin-right: 15px; background: #e74c3c;">
                <i class="fas fa-skull-crossbones"></i>
            </div>
            <div class="stat-info">
                {% set kadaluarsa = monitoring|selectattr('status_kadaluarsa', 'equalto', 'kadaluarsa')|list|length %}
                <h4>{{ kadaluarsa }}</h4>
                <p>Bahan Kadaluarsa</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}